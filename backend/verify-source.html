<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Source Verification</title>
    <style>
      body {
        font-family: system-ui, -apple-system, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: #1a1a1a;
        color: #fff;
      }
      .result {
        background: #2a2a2a;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
      }
      .success {
        border-left: 4px solid #4caf50;
      }
      .error {
        border-left: 4px solid #f44336;
      }
      .info {
        border-left: 4px solid #2196f3;
      }
      code {
        background: #1a1a1a;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ” Data Source Verification</h1>

    <div id="results"></div>

    <script>
      const results = document.getElementById("results");

      function addResult(title, message, type = "info") {
        const div = document.createElement("div");
        div.className = `result ${type}`;
        div.innerHTML = `<strong>${title}</strong><br>${message}`;
        results.appendChild(div);
      }

      // Check API Base URL
      const hostname = window.location.hostname;
      const apiBase =
        hostname === "localhost" || hostname === "127.0.0.1"
          ? "http://localhost:3000/api"
          : "https://franky-app-ix96j.ondigitalocean.app/api";

      addResult("ğŸ“ Current Hostname", `<code>${hostname}</code>`, "info");
      addResult("ğŸŒ API Base URL", `<code>${apiBase}</code>`, "info");

      // Test API
      fetch(`${apiBase}/strains`)
        .then((response) => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.json();
        })
        .then((data) => {
          addResult(
            "âœ… API Connection",
            `Successfully connected to <code>${apiBase}</code>`,
            "success"
          );
          addResult(
            "ğŸ“Š Data Retrieved",
            `${data.length} strains found`,
            "success"
          );
          addResult(
            "ğŸ“‹ Sample Strain",
            `${data[0]?.name || "N/A"} (${data[0]?.type || "N/A"})`,
            "info"
          );

          // Check if it's local backend (has _id field)
          if (data[0]?._id) {
            addResult(
              "ğŸ’¾ Data Source",
              "Local SQLite Database (via Node.js backend)",
              "success"
            );
            addResult(
              "ğŸ”— Database Location",
              "<code>backend/data/strains.db</code>",
              "info"
            );
          } else {
            addResult("ğŸ’¾ Data Source", "Remote API (DigitalOcean)", "info");
          }
        })
        .catch((error) => {
          addResult("âŒ API Connection Failed", error.message, "error");
          addResult(
            "ğŸ’¡ Fallback",
            "Frontend will use LocalStorage or strains.json",
            "info"
          );
        });

      // Check LocalStorage
      try {
        const cached = localStorage.getItem("smokestack_strains");
        if (cached) {
          const data = JSON.parse(cached);
          addResult(
            "ğŸ’¿ LocalStorage Cache",
            `${data.length} strains cached`,
            "info"
          );
        } else {
          addResult("ğŸ’¿ LocalStorage Cache", "No cached data", "info");
        }
      } catch (e) {
        addResult("ğŸ’¿ LocalStorage", "Not available", "error");
      }
    </script>
  </body>
</html>
